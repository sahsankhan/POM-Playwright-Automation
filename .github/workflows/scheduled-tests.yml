name: Scheduled Tests

on:
  schedule:
    # Run tests every day at 9 AM UTC (adjust as needed)
    - cron: '0 9 * * *'
  workflow_dispatch:

jobs:
  scheduled-test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps
    
    - name: Run Section 1 Tests
      run: npx cucumber-js --tags "@Section1"
      continue-on-error: true
      env:
        BASE_URL: ${{ vars.BASE_URL || 'https://sample-project-dusky.vercel.app' }}
        BROWSER: chromium
        HEADLESS: true
        TIMEOUT: ${{ vars.TIMEOUT || '60000' }}
    
    - name: Run Section 2 Tests
      run: npx cucumber-js --tags "@Section2"
      continue-on-error: true
      env:
        BASE_URL: ${{ vars.BASE_URL || 'https://sample-project-dusky.vercel.app' }}
        BROWSER: chromium
        HEADLESS: true
        TIMEOUT: ${{ vars.TIMEOUT || '60000' }}
    
    - name: Generate HTML Report
      if: always()
      run: npm run report
      continue-on-error: true
    
    - name: Upload test results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: scheduled-test-results
        path: reports/
        retention-days: 30
    
    - name: Upload HTML Report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: scheduled-html-report
        path: reports/html-report/
        retention-days: 30
    
    - name: Send notification on failure
      if: failure()
      run: |
        echo "Tests failed! Check the artifacts for details."
        echo "Report available at: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"

